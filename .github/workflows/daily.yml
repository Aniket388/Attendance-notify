name: Daily Attendance Check

on:
  schedule:
    # -----------------------------------------------------------------
    # ‚è∞ SCHEDULE (UTC TIME)
    # India (IST) is UTC + 5:30.
    # We want 6:30 AM IST.
    # Calculation: 6:30 - 5:30 = 1:00 AM UTC.
    # -----------------------------------------------------------------
    - cron: '0 1 * * *'

  # Keep manual trigger for testing
  workflow_dispatch:

jobs:
  check-attendance:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Libraries
        run: pip install selenium webdriver-manager supabase cryptography google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client

      - name: Run Attendance Script
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          MASTER_KEY: ${{ secrets.MASTER_KEY }}
          GMAIL_TOKEN_JSON: ${{ secrets.GMAIL_TOKEN_JSON }}
        run: python attendance.py
