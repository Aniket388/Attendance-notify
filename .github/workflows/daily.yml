name: Daily Attendance Check

on:
  schedule:
    # -----------------------------------------------------------------
    # ‚è∞ SCHEDULE (UTC TIME)
    # India (IST) is UTC + 5:30.
    # -----------------------------------------------------------------

    # ‚òÄÔ∏è MORNING: 7:05 AM IST (01:35 UTC)
    - cron: '35 1 * * *'

    # üå§Ô∏è AFTERNOON: 11:35 AM IST (06:05 UTC)
    - cron: '5 6 * * *'

    # üåô NIGHT (DOUBLE TAP STRATEGY):
    # Trigger 1: 6:15 PM IST (12:45 UTC)
    - cron: '45 12 * * *'
    
    # Trigger 2: 6:45 PM IST (13:15 UTC)
    - cron: '15 13 * * *'

  # This brings back the "Run workflow" button!
  workflow_dispatch:

jobs:
  check-attendance:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Libraries
        # We added 'supabase' and 'cryptography' here
        run: pip install selenium webdriver-manager supabase cryptography

      - name: Run Attendance Script
        env:
          # V2 SECRETS (For Database)
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          MASTER_KEY: ${{ secrets.MASTER_KEY }}
          # V1 SECRETS (For Email)
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
        run: python attendance.py
