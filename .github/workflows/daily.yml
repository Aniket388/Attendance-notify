name: Daily Attendance Check

on:
  schedule:
    # -----------------------------------------------------------------
    # ‚è∞ SCHEDULE (UTC TIME)
    # India (IST) is UTC + 5:30.
    # -----------------------------------------------------------------

    # ‚òÄÔ∏è MORNING: 7:05 AM IST (01:35 UTC)
    - cron: '35 1 * * *'

    # üå§Ô∏è AFTERNOON: 11:35 AM IST (06:05 UTC)
    - cron: '5 6 * * *'

    # üåô NIGHT (DOUBLE TAP STRATEGY):
    # Trigger 1: 6:15 PM IST (12:45 UTC)
    - cron: '45 12 * * *'
    
    # Trigger 2: 6:45 PM IST (13:15 UTC)
    - cron: '15 13 * * *'

  # This brings back the "Run workflow" button!
  workflow_dispatch:

jobs:
  check-attendance:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Libraries
        # We added 'supabase' and 'cryptography' here
        run: pip install selenium webdriver-manager supabase cryptography google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client
        - name: Run Attendance Script
        env:
          # Database Secrets
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          MASTER_KEY: ${{ secrets.MASTER_KEY }}
          
          # ‚ö†Ô∏è THIS WAS MISSING! Hand the Token to the script:
          GMAIL_TOKEN_JSON: ${{ secrets.GMAIL_TOKEN_JSON }}
          
        run: python attendance.py
